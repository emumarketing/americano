{{dataname}}Model = require('../../models/{{dataname}}Model')

module.exports = {{dataname}}Mixin =

  action_{{lowercase dataname}}_index: (req, res) =>
    {{dataname}}Model.find {}, (err, items) ->
      res.render "{{lowercase resource}}/{{lowercase dataname}}", {item: items, errors: err}
    return

  action_{{lowercase dataname}}_create: (req, res) =>
    res.render "{{lowercase resource}}/{{lowercase dataname}}/create", {item: {}, action: "/{{lowercase resource}}/{{lowercase dataname}}/new"}
    return

  action_{{lowercase dataname}}_new: (req, res) =>
    params = req.body
    {{dataname}} = new {{dataname}}Model{{#eachProp data}}
      {{key}}: params.{{key}},{{/eachProp}}
      slug: params.slug,

    {{dataname}}.save (err) ->
      if (err)
        res.render "{{lowercase resource}}/{{lowercase dataname}}/create", {item: params, errors: err, action: "/{{lowercase resource}}/{{lowercase dataname}}/new"}
      else
        res.redirect "/{{lowercase resource}}/{{lowercase dataname}}"
    return

  action_{{lowercase dataname}}_edit: (req, res) =>
    slug = req.params.slug
    {{dataname}}Model.findOne {"slug": slug}, (err, item) ->
      if !err and item?
        res.render "{{lowercase resource}}/{{lowercase dataname}}/edit", {item: item, errors: err, action: "/{{lowercase resource}}/{{lowercase dataname}}/update/#{item.slug}"}
      else
        res.send "Not a Valid {{dataname}} To Edit"
    return

  action_{{lowercase dataname}}_update: (req, res) =>
    slug = req.params.slug
    {{dataname}}Model.findOne {"slug", slug}, (err, item) ->{{#eachProp data}}
      item.{{key}} = req.body.{{key}}{{/eachProp}}
      old_slug = item.slug
      item.slug = req.body.slug
      item.save (err) ->
        if (!err)
          res.redirect "/{{lowercase resource}}/{{lowercase dataname}}"
        else
          item.slug = old_slug
          res.render "{{lowercase resource}}/{{lowercase dataname}}/edit", {item: item, errors: err, action: "/{{lowercase resource}}/{{lowercase dataname}}/update/#{old_slug}"}

